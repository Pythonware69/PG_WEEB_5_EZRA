<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
    </script>
    <script>
        // Inisialisasi peta
        var map = L.map("map").setView([-8.2882783,122.9476547], 9);

        // Tile Layer Base Map
        var basemap = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution:
                '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        });

        var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });

        // Menambahkan basemap ke dalam peta
        basemap.addTo(map);

        // Define layer groups
        let toponimi = L.layerGroup();

        // Load geojson file
           
        fetch('datas/toponimi.geojson')
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, {
                     pointToLayer: function (feature, latlng) {
	                    return L.marker(latlng, {
                        icon: L.icon({
                        iconUrl: "icon/home_marker.png", // icon marker
                        iconSize: [48, 48], // ukuran icon
                        iconAnchor: [24, 48], // posisi icon terhadap titik (point)
                        popupAnchor: [0, -48], // posisi popup terhadap icon
                        tooltipAnchor: [-16, -30], // posisi tooltip terhadap icon
                    }),
                });
            },
                    onEachFeature: function(feature, layer) {
                        var popup_content = "Nama: " + feature.properties.TOPONIMI + "<br>" +
                            "Koordinat: " + feature.geometry.coordinates[1] + ", " +
                            feature.geometry.coordinates[0];
                        layer.bindPopup(popup_content);

                        layer.bindTooltip(feature.properties.TOPONIMI, {
                            direction:'left',
                            sticky: true,
                        }).openTooltip();
                    }
                }).addTo(toponimi);
            });

       toponimi.addTo(map);

       // GeoJSON Polyline Jalan
       map.createPane('roadPane');
       map.getPane('roadPane').style.zIndex = 401;
        var road = L.geoJSON(null, {
            pane: 'roadPane',
	        style: function (feature) {
	            return {
		            color: "red",
		            opacity: 1,
		            weight: 3,
	            };
            },
            mouseover: function (e) {
	            road.bindTooltip(feature.properties.NAMA_UNSUR, {
		            direction: "auto",
		            sticky: true,
	            });
            },
        });

        $.getJSON('datas/road.geojson', function (data) {
	        road.addData(data); // Menambahkan data ke dalam GeoJSON Polyline Jalan
	        map.addLayer(road); // Menambahkan GeoJSON Polyline Jalan ke dalam peta
                
        });

        // GeoJSON Polyline RIVER
        map.createPane('riverPane');
        map.getPane('riverPane').style.zIndex = 400;
        var river = L.geoJSON(null, {
	        style: function (feature) {
	            return {
		            color: "blue",
		            opacity: 1,
		            weight: 3,
	            };
            },
            mouseover: function (e) {
	            river.bindTooltip(feature.properties.NAMA_UNSUR, {
		            direction: "auto",
		            sticky: true,
	            });
            },
        });

        $.getJSON('datas/river.geojson', function (data) {
	        river.addData(data); // Menambahkan data ke dalam GeoJSON Polyline Jalan
	        map.addLayer(river); // Menambahkan GeoJSON Polyline Jalan ke dalam peta
                
        });

    // GeoJSON Polygon Jumlah Penduduk
    map.createPane('PendudukPane');
    map.getPane('PendudukPane').style.zIndex = 301;
    var Penduduk = L.geoJSON(null, {
	    style: function (feature) {
	        return {
		        color: "purple",
		        opacity: 1,
		        weight: 1,
		        fillColor: "yellow",
		        fillOpacity: 0.4,
	        };
        },
        style: function (feature) {
	        if (feature.properties.Penduduk <= 15000) {
		        return {
                    opacity: 1,
                    color: 'black',
                    weight: 1.0,
                    fillOpacity: 0.7,
                    fillColor: '#ffffb2'
		        }
	        }
            if (feature.properties.Penduduk > 15000 && feature.properties.Penduduk <= 30000) {
                return {
                    opacity: 1,
                    color: 'black',
                    weight: 1.0,
                    fillOpacity: 0.7,
                    fillColor: '#fd8d3c'
                }
            }
            if (feature.properties.Penduduk > 30000) {
                return {
                    opacity: 1,
                    color: 'black',
                    weight: 1.0,
                    fillOpacity: 0.7,
                    fillColor: '#bd0026'
                }
            }
        },

        onEachFeature: function (feature, layer) {
	        // variable popup content
	        var popup_content = "Kecamatan: " + feature.properties.NAMOBJ + "<br>" +
	        "Jumlah Penduduk: " + feature.properties.Penduduk;

	            layer.on({
		            click: function (e) {
			        Penduduk.bindPopup(popup_content);
		        },
	        });
        },

    });

    $.getJSON('datas/ttest.geojson', function (data) {
        Penduduk.addData(data); // Menambahkan data ke dalam GeoJSON Polygon Jumlah Penduduk
	    map.addLayer(Penduduk); // Menambahkan GeoJSON Polygon Jumlah Penduduk ke dalam peta
    });

    //Control Layer
    var controlLayer = {
        collapsed: true,
    };

    var baseMaps = {
        "OpenStreetMap": basemap,
        "Google Satellite": googleSat
    };

    var overlayMaps = {
        "Toponimi": toponimi,
        "Jalan": road,
        "Sungai": river,
        "Jumlah Penduduk": Penduduk
    };

    var layerControl = L.control.layers(baseMaps, overlayMaps, controlLayer).addTo(map);

        
    </script>
</body>
</html>
